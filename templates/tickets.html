<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

<style>
  .payment-section {
    background: rgba(229, 9, 20, 0.1);
    border: 2px solid #e50914;
    padding: 30px;
    border-radius: 10px;
    margin-top: 30px;
  }

  .payment-title {
    color: #e50914;
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 20px;
    text-transform: uppercase;
  }

  .payment-method-group {
    margin-bottom: 25px;
  }

  .payment-method-label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    padding: 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 5px;
    margin-bottom: 10px;
    transition: all 0.3s ease;
  }

  .payment-method-label:hover {
    background: rgba(229, 9, 20, 0.2);
  }

  .payment-method-label input[type="radio"] {
    cursor: pointer;
    width: 18px;
    height: 18px;
  }

  .payment-options {
    display: none;
    margin-left: 30px;
    margin-top: 10px;
  }

  .payment-options.show {
    display: block;
  }

  .sub-option {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    background: rgba(255, 255, 255, 0.02);
    border-radius: 5px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .sub-option:hover {
    background: rgba(229, 9, 20, 0.15);
  }

  .sub-option input[type="radio"] {
    cursor: pointer;
  }

  .payment-button {
    background: #e50914;
    color: white;
    border: none;
    padding: 12px 30px;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 20px;
    width: 100%;
  }

  .payment-button:hover {
    background: #c40812;
  }

  .payment-button:disabled {
    background: #666;
    cursor: not-allowed;
  }
</style>

<div class="container">
  <h2>üéâ Booking Confirmed</h2>

  <div class="confirm">
    <p><b>Movie:</b> {{ booking.movie }}</p>
    <p><b>Theater:</b> {{ booking.theater }}</p>
    <p><b>Seats:</b> {{ booking.seats }}</p>
    <p><b>Number of Seats:</b> {{ booking.num_seats }}</p>
    <p><b>Price per Seat:</b> ‚Çπ{{ booking.price_per_seat }}</p>
    <p><b>Total Price:</b> ‚Çπ{{ booking.total_price }}</p>
    <p><b>Time:</b> {{ booking.booking_time }}</p>
  </div>

  <div class="payment-section">
    <div class="payment-title">üí≥ Select Payment Method</div>
    
    <form method="post" action="/process-payment" id="paymentForm">
      <input type="hidden" name="booking_id" value="{{ booking.booking_id }}">
      <input type="hidden" name="total_price" value="{{ booking.total_price }}">
      <input type="hidden" name="payment_method" id="paymentMethod" value="">
      <input type="hidden" name="payment_option" id="paymentOption" value="">

      <!-- Online Payment -->
      <div class="payment-method-group">
        <label class="payment-method-label">
          <input type="radio" name="method" value="online" onchange="togglePaymentOptions('online')">
          <span>üíª Online Payment</span>
        </label>
        <div class="payment-options" id="onlineOptions">
          <label class="sub-option">
            <input type="radio" name="online_method" value="paytm" onchange="setPaymentOption('online', 'paytm')">
            <span>üì± Paytm</span>
          </label>
          <label class="sub-option">
            <input type="radio" name="online_method" value="googlepay" onchange="setPaymentOption('online', 'googlepay')">
            <span>üîµ Google Pay</span>
          </label>
        </div>
      </div>

      <!-- Cash on Delivery -->
      <div class="payment-method-group">
        <label class="payment-method-label">
          <input type="radio" name="method" value="cod" onchange="togglePaymentOptions('cod')">
          <span>üè™ Cash on Delivery</span>
        </label>
      </div>

      <button type="submit" class="payment-button" id="payBtn" disabled>Proceed to Payment</button>
    </form>
  </div>

  <div style="display: flex; gap: 10px; margin-top: 20px;">
    <a href="/home" style="display: inline-block; padding: 10px 20px; background: #e50914; color: white; text-decoration: none; border-radius: 5px; transition: all 0.3s ease;" onmouseover="this.style.background='#c40812'" onmouseout="this.style.background='#e50914'">‚¨Ö Back to Home</a>
    <a href="/my-bookings" style="display: inline-block; padding: 10px 20px; background: rgba(255, 255, 255, 0.1); color: white; text-decoration: none; border-radius: 5px; border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255, 255, 255, 0.15)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">üìã View My Bookings</a>
  </div>
</div>

<script>
  function togglePaymentOptions(method) {
    const onlineDiv = document.getElementById('onlineOptions');
    const payBtn = document.getElementById('payBtn');
    const paymentMethod = document.getElementById('paymentMethod');
    
    if (method === 'online') {
      onlineDiv.classList.add('show');
      // Enable button only if a sub-option is selected
      checkOnlineSelection();
    } else if (method === 'cod') {
      onlineDiv.classList.remove('show');
      paymentMethod.value = 'cod';
      payBtn.disabled = false;
    }
  }

  function setPaymentOption(method, option) {
    const paymentMethod = document.getElementById('paymentMethod');
    const paymentOption = document.getElementById('paymentOption');
    const payBtn = document.getElementById('payBtn');
    
    paymentMethod.value = method;
    paymentOption.value = option;
    payBtn.disabled = false;
  }

  function checkOnlineSelection() {
    const onlineMethod = document.querySelector('input[name="online_method"]:checked');
    const payBtn = document.getElementById('payBtn');
    payBtn.disabled = !onlineMethod;
  }

  // Enable/disable button when radio changes
  document.querySelectorAll('input[name="online_method"]').forEach(radio => {
    radio.addEventListener('change', checkOnlineSelection);
  });
</script>
